import os

from fastlogfileparser.gaussian import fast_gaussian_logfile_parser


def test_fast_gaussian_logfile_parser():
    """
    Test parser using a log file with gaussian LINK of three consecutive semi-empirical level jobs AM1, PM7, XTB
    """

    file = os.path.join(os.path.dirname(__file__), "data", "rxn_11.log")
    job_1, job_2, job_3 = fast_gaussian_logfile_parser(file)
    print(job_1["normal_termination"])
    assert job_1["gibbs"] == 0.453491
    assert job_2["gibbs"] == 0.377958
    assert job_3["gibbs"] == -57.116221
    assert job_1["e0_zpe"] == 0.501018
    assert job_2["e0_zpe"] == 0.424827
    assert job_3["e0_zpe"] == -57.066865
    assert job_1["zpe"] == 0.2756248
    assert job_2["zpe"] == 0.2546919
    assert job_3["zpe"] == 0.2611432
    assert job_1["e0_h"] == 0.519054
    assert job_2["e0_h"] == 0.442973
    assert job_3["e0_h"] == -57.047106
    assert job_1["hf"] == 0.2253936
    assert job_2["hf"] == 0.1701352
    assert job_3["hf"] == -57.3280082
    assert job_1["cpu_time"] == 1729.1
    assert job_2["cpu_time"] == 732.8
    assert job_3["cpu_time"] == 450.9
    assert job_1["wall_time"] == 133.3
    assert job_2["wall_time"] == 57.3
    assert job_3["wall_time"] == 67.0
    assert job_1["number_of_atoms"] == 35
    assert job_2["number_of_atoms"] == 35
    assert job_3["number_of_atoms"] == 35
    assert job_1["number_of_optimization_steps"] == 18
    assert job_2["number_of_optimization_steps"] == 9
    assert job_3["number_of_optimization_steps"] == 31
    assert job_1["recovered_energy"] is None
    assert job_2["recovered_energy"] is None
    assert job_3["recovered_energy"][0] == -57.3069045667
    assert job_3["recovered_energy"][1] == -57.3139032763
    assert job_3["recovered_energy"][-2] == -57.328008209
    assert job_3["recovered_energy"][-1] == -57.3280082435
    assert len(job_3["recovered_energy"]) == 31
    assert job_1["frequencies"][0] == -2302.4897
    assert job_1["frequencies"][-1] == 3367.7609
    assert len(job_1["frequencies"]) == 99
    assert job_2["frequencies"][1] == -65.2439
    assert job_2["frequencies"][-2] == 2772.4802
    assert len(job_2["frequencies"]) == 99
    assert job_3["frequencies"] == [-1070.248,
                                        21.2558,
                                        34.2835,
                                        38.4794,
                                        50.8615,
                                        66.318,
                                        72.0175,
                                        104.4354,
                                        126.2533,
                                        178.164,
                                        190.6464,
                                        201.5766,
                                        230.1125,
                                        244.0453,
                                        258.3915,
                                        288.0747,
                                        319.5283,
                                        331.1254,
                                        337.4849,
                                        362.0772,
                                        376.8511,
                                        380.6593,
                                        419.7345,
                                        480.4958,
                                        483.6609,
                                        516.5783,
                                        523.9647,
                                        539.752,
                                        560.1229,
                                        593.1202,
                                        618.2125,
                                        629.2787,
                                        665.2088,
                                        680.6649,
                                        699.5886,
                                        710.2207,
                                        768.6965,
                                        769.6295,
                                        825.1324,
                                        858.965,
                                        876.7569,
                                        896.6266,
                                        912.0599,
                                        913.4817,
                                        918.0845,
                                        923.8787,
                                        931.8196,
                                        1007.5661,
                                        1052.9469,
                                        1060.3788,
                                        1065.9656,
                                        1077.552,
                                        1092.4222,
                                        1099.997,
                                        1108.2718,
                                        1122.1112,
                                        1129.8856,
                                        1145.5331,
                                        1160.5772,
                                        1167.1457,
                                        1177.2996,
                                        1197.0858,
                                        1204.0635,
                                        1241.2318,
                                        1269.6735,
                                        1278.369,
                                        1285.7483,
                                        1298.9741,
                                        1343.8235,
                                        1366.2008,
                                        1380.2288,
                                        1392.7438,
                                        1400.2953,
                                        1420.7035,
                                        1433.8104,
                                        1437.2969,
                                        1466.1181,
                                        1472.7239,
                                        1480.3023,
                                        1492.9849,
                                        1561.163,
                                        1584.5292,
                                        1586.8818,
                                        1598.23,
                                        1676.3884,
                                        2926.8699,
                                        2958.67,
                                        2992.993,
                                        3055.6369,
                                        3071.0991,
                                        3078.5004,
                                        3090.5944,
                                        3099.3502,
                                        3103.0384,
                                        3103.9318,
                                        3108.6467,
                                        3144.2251,
                                        3148.1604,
                                        3481.313]
    assert len(job_3["frequencies"]) == 99
    assert len(job_1["std_forces"]) == 19
    assert len(job_1["std_forces"][0]) == 35
    assert job_1["std_forces"][0][0] == [
        1.0,
        1.0,
        -0.012034736,
        0.000231533,
        -0.008718935,
    ]
    assert job_1["std_forces"][0][-1] == [
        35.0,
        1.0,
        0.002160253,
        -0.010676581,
        -0.009002864,
    ]
    assert job_1["std_forces"][-1][0] == [1.0, 1.0, -8e-08, -9e-09, 1.92e-07]
    assert job_1["std_forces"][-1][-1] == [35.0, 1.0, -2.2e-08, 1.8e-08, -1e-09]
    assert len(job_2["std_forces"]) == 10
    assert len(job_2["std_forces"][0]) == 35
    assert job_2["std_forces"][0][0] == [
        1.0,
        1.0,
        0.013295924,
        -0.000472478,
        0.000883286,
    ]
    assert job_2["std_forces"][0][-1] == [
        35.0,
        1.0,
        -0.000877563,
        0.001225992,
        0.003512116,
    ]
    assert job_2["std_forces"][-1][0] == [1.0, 1.0, 2.06e-07, -1.15e-07, -2.2e-08]
    assert job_2["std_forces"][-1][-1] == [35.0, 1.0, 6e-09, 5e-09, 2e-09]
    assert len(job_3["std_forces"]) == 32
    assert len(job_3["std_forces"][0]) == 35
    assert job_3["std_forces"][0][0] == [
        1.0,
        1.0,
        -0.016887644,
        -0.00517337,
        -0.008264572,
    ]
    assert job_3["std_forces"][0][-1] == [
        35.0,
        1.0,
        -0.001623912,
        0.006837508,
        0.008029253,
    ]
    assert job_3["std_forces"][-1][0] == [1.0, 1.0, -5.19e-07, -2.07e-07, 3.29e-07]
    assert job_3["std_forces"][-1][-1] == [35.0, 1.0, 1.95e-07, -5.4e-08, 8.3e-08]
    assert len(job_1["std_xyz"]) == 19
    assert len(job_1["std_xyz"][0]) == 35
    assert job_1["std_xyz"][0][0] == [1.0, 1.0, 0.0, -0.274545, -2.553625, 1.166114]
    assert job_1["std_xyz"][0][-1] == [35.0, 1.0, 0.0, -3.902734, 2.175794, 1.493715]
    assert job_1["std_xyz"][1][0] == [1.0, 1.0, 0.0, 0.104125, -2.044038, 1.430378]
    assert job_1["std_xyz"][1][-1] == [35.0, 1.0, 0.0, -4.005975, 1.944035, 1.575083]
    assert job_1["std_xyz"][-1][0] == [1.0, 1.0, 0.0, 2.288411, -1.715873, 2.983735]
    assert job_1["std_xyz"][-1][-1] == [35.0, 1.0, 0.0, -3.483513, 0.579376, 2.671913]
    assert len(job_2["std_xyz"]) == 10
    assert len(job_2["std_xyz"][0]) == 35
    assert job_2["std_xyz"][0][0] == [1.0, 1.0, 0.0, 2.288411, -1.715873, 2.983735]
    assert job_2["std_xyz"][0][-1] == [35.0, 1.0, 0.0, -3.483513, 0.579376, 2.671913]
    assert job_2["std_xyz"][1][0] == [1.0, 1.0, 0.0, 1.46839, -1.948579, 2.481679]
    assert job_2["std_xyz"][1][-1] == [35.0, 1.0, 0.0, -3.336096, 0.644271, 2.658772]
    assert job_2["std_xyz"][-1][0] == [1.0, 1.0, 0.0, 0.277827, -0.733444, 2.34837]
    assert job_2["std_xyz"][-1][-1] == [35.0, 1.0, 0.0, -3.292172, 2.078041, 1.982963]
    assert len(job_3["std_xyz"]) == 32
    assert len(job_3["std_xyz"][0]) == 35
    assert job_3["std_xyz"][0][0] == [1.0, 1.0, 0.0, 0.277827, -0.733444, 2.34837]
    assert job_3["std_xyz"][0][-1] == [35.0, 1.0, 0.0, -3.292172, 2.078041, 1.982963]
    assert job_3["std_xyz"][1][0] == [1.0, 1.0, 0.0, 0.322829, -0.775239, 2.426687]
    assert job_3["std_xyz"][1][-1] == [35.0, 1.0, 0.0, -3.297056, 2.031193, 1.995294]
    assert job_3["std_xyz"][-1][0] == [1.0, 1.0, 0.0, 1.785766, -1.923322, 2.412318]
    assert job_3["std_xyz"][-1][-1] == [35.0, 1.0, 0.0, -4.255334, 1.709578, 1.25933]
    assert len(job_1["xyz"]) == 19
    assert len(job_1["xyz"][0]) == 35
    assert job_1["xyz"][0] == [
        [1.0, 1.0, 0.0, -0.685827, 1.281098, 0.993117],
        [2.0, 8.0, 0.0, 0.282333, 0.454653, -0.531484],
        [3.0, 8.0, 0.0, 0.032084, 1.524857, 0.372679],
        [4.0, 7.0, 0.0, -2.251385, -1.506529, -0.269281],
        [5.0, 7.0, 0.0, -3.643363, 0.259986, 0.208542],
        [6.0, 7.0, 0.0, -1.876414, -0.197147, 1.767129],
        [7.0, 7.0, 0.0, -4.830772, 2.343331, 0.078931],
        [8.0, 6.0, 0.0, -0.890949, -1.809402, -0.685049],
        [9.0, 6.0, 0.0, -0.85843, -1.101086, 2.273594],
        [10.0, 6.0, 0.0, -3.173691, -1.361721, -1.330426],
        [11.0, 6.0, 0.0, -4.030871, -0.289132, -1.041317],
        [12.0, 6.0, 0.0, -2.523242, -0.481582, 0.68225],
        [13.0, 6.0, 0.0, -4.208983, 1.400641, 0.838576],
        [14.0, 6.0, 0.0, -5.051916, 0.056537, -1.908798],
        [15.0, 6.0, 0.0, -3.326203, -2.107799, -2.487223],
        [16.0, 6.0, 0.0, -4.164939, 1.563181, 2.22734],
        [17.0, 6.0, 0.0, -4.724558, 2.691777, 2.830231],
        [18.0, 6.0, 0.0, -5.205612, -0.683427, -3.084837],
        [19.0, 6.0, 0.0, -4.350264, -1.757896, -3.371327],
        [20.0, 6.0, 0.0, -5.332709, 3.651664, 2.040549],
        [21.0, 6.0, 0.0, -5.362433, 3.432163, 0.679269],
        [22.0, 1.0, 0.0, -0.152123, -0.663302, -0.776045],
        [23.0, 1.0, 0.0, -0.804732, -2.296992, -1.661596],
        [24.0, 1.0, 0.0, -0.382917, -2.451722, 0.039787],
        [25.0, 1.0, 0.0, -0.725911, -0.91287, 3.344093],
        [26.0, 1.0, 0.0, -1.147776, -2.152301, 2.176818],
        [27.0, 1.0, 0.0, 0.108545, -0.925978, 1.794821],
        [28.0, 1.0, 0.0, -3.721105, 0.807456, 2.866516],
        [29.0, 1.0, 0.0, -4.684515, 2.808175, 3.909428],
        [30.0, 1.0, 0.0, -5.775815, 4.540964, 2.472892],
        [31.0, 1.0, 0.0, -5.725406, 0.878601, -1.694563],
        [32.0, 1.0, 0.0, -6.000513, -0.425654, -3.781039],
        [33.0, 1.0, 0.0, -4.492757, -2.328099, -4.286496],
        [34.0, 1.0, 0.0, -2.691067, -2.958123, -2.706509],
        [35.0, 1.0, 0.0, -5.829554, 4.146093, 0.007037],
    ]
    assert len(job_2["xyz"]) == 10
    assert len(job_2["xyz"][0]) == 35
    assert job_2["xyz"][1] == [
        [1.0, 1.0, 0.0, -0.026543, 1.559817, -0.795496],
        [2.0, 8.0, 0.0, 0.8069, -0.078595, -0.680779],
        [3.0, 8.0, 0.0, 0.375637, 0.941727, -1.45434],
        [4.0, 7.0, 0.0, -2.201407, -1.312788, -0.325969],
        [5.0, 7.0, 0.0, -4.021185, -0.161056, 0.567202],
        [6.0, 7.0, 0.0, -2.108753, -0.315467, 1.966785],
        [7.0, 7.0, 0.0, -4.373636, 2.183848, 0.253664],
        [8.0, 6.0, 0.0, -0.970021, -1.90388, -0.488426],
        [9.0, 6.0, 0.0, -0.781134, -0.678582, 2.377951],
        [10.0, 6.0, 0.0, -3.174959, -1.188581, -1.341315],
        [11.0, 6.0, 0.0, -4.273086, -0.445325, -0.810897],
        [12.0, 6.0, 0.0, -2.652065, -0.586117, 0.83989],
        [13.0, 6.0, 0.0, -4.384383, 1.122763, 1.094057],
        [14.0, 6.0, 0.0, -5.395024, -0.18364, -1.57887],
        [15.0, 6.0, 0.0, -3.196767, -1.663947, -2.644548],
        [16.0, 6.0, 0.0, -4.760752, 1.211251, 2.446479],
        [17.0, 6.0, 0.0, -5.145038, 2.458978, 2.931547],
        [18.0, 6.0, 0.0, -5.410314, -0.672197, -2.890992],
        [19.0, 6.0, 0.0, -4.335571, -1.393151, -3.411174],
        [20.0, 6.0, 0.0, -5.147726, 3.559747, 2.076509],
        [21.0, 6.0, 0.0, -4.754614, 3.375701, 0.743142],
        [22.0, 1.0, 0.0, -0.088209, -0.905746, -0.794734],
        [23.0, 1.0, 0.0, -0.844214, -2.515371, -1.390082],
        [24.0, 1.0, 0.0, -0.476731, -2.29591, 0.405274],
        [25.0, 1.0, 0.0, -0.589403, -0.140152, 3.33449],
        [26.0, 1.0, 0.0, -0.679857, -1.763621, 2.580599],
        [27.0, 1.0, 0.0, 0.005966, -0.367968, 1.656735],
        [28.0, 1.0, 0.0, -4.732179, 0.328348, 3.08754],
        [29.0, 1.0, 0.0, -5.439619, 2.569641, 3.977629],
        [30.0, 1.0, 0.0, -5.443202, 4.545108, 2.431175],
        [31.0, 1.0, 0.0, -6.231139, 0.39089, -1.180685],
        [32.0, 1.0, 0.0, -6.282697, -0.47693, -3.5176],
        [33.0, 1.0, 0.0, -4.378414, -1.755264, -4.440389],
        [34.0, 1.0, 0.0, -2.361697, -2.222314, -3.064184],
        [35.0, 1.0, 0.0, -4.731955, 4.209199, 0.027422],
    ]
    assert len(job_3["xyz"]) == 32
    assert len(job_3["xyz"][0]) == 35
    assert job_3["xyz"][-1] == [
        [1.0, 1.0, 0.0, 0.261758, 1.177112, -0.548527],
        [2.0, 8.0, 0.0, 0.745479, -0.574321, -1.041625],
        [3.0, 8.0, 0.0, -0.019596, 0.573298, -1.25073],
        [4.0, 7.0, 0.0, -2.211764, -1.28394, -0.297995],
        [5.0, 7.0, 0.0, -3.655424, 0.33813, 0.297466],
        [6.0, 7.0, 0.0, -1.944001, -0.081389, 1.806119],
        [7.0, 7.0, 0.0, -5.092337, 2.13712, 0.283995],
        [8.0, 6.0, 0.0, -1.129849, -2.154884, -0.329376],
        [9.0, 6.0, 0.0, -0.73964, -0.64677, 2.332096],
        [10.0, 6.0, 0.0, -3.090977, -1.098156, -1.343025],
        [11.0, 6.0, 0.0, -4.000963, -0.092303, -0.977375],
        [12.0, 6.0, 0.0, -2.517241, -0.355322, 0.710019],
        [13.0, 6.0, 0.0, -4.301828, 1.350199, 1.00503],
        [14.0, 6.0, 0.0, -5.026306, 0.271375, -1.830989],
        [15.0, 6.0, 0.0, -3.175444, -1.738314, -2.569467],
        [16.0, 6.0, 0.0, -4.149764, 1.512273, 2.385036],
        [17.0, 6.0, 0.0, -4.83787, 2.54003, 2.999857],
        [18.0, 6.0, 0.0, -5.108701, -0.377149, -3.053745],
        [19.0, 6.0, 0.0, -4.198094, -1.360121, -3.420661],
        [20.0, 6.0, 0.0, -5.654828, 3.369304, 2.24306],
        [21.0, 6.0, 0.0, -5.745145, 3.113852, 0.886691],
        [22.0, 1.0, 0.0, -0.073673, -1.421413, -0.720914],
        [23.0, 1.0, 0.0, -1.224998, -2.905299, -1.103399],
        [24.0, 1.0, 0.0, -0.849007, -2.560162, 0.631473],
        [25.0, 1.0, 0.0, -0.441059, -0.009306, 3.165967],
        [26.0, 1.0, 0.0, -0.909434, -1.654458, 2.724124],
        [27.0, 1.0, 0.0, 0.078389, -0.685018, 1.609106],
        [28.0, 1.0, 0.0, -3.504246, 0.854467, 2.937701],
        [29.0, 1.0, 0.0, -4.741294, 2.690479, 4.065276],
        [30.0, 1.0, 0.0, -6.203504, 4.18129, 2.692587],
        [31.0, 1.0, 0.0, -5.72258, 1.042235, -1.55284],
        [32.0, 1.0, 0.0, -5.89737, -0.105314, -3.738331],
        [33.0, 1.0, 0.0, -4.286628, -1.836519, -4.384844],
        [34.0, 1.0, 0.0, -2.467614, -2.496701, -2.862313],
        [35.0, 1.0, 0.0, -6.368236, 3.716111, 0.238162],
    ]
    assert job_1["max_steps"] == 64
    assert job_2["max_steps"] == 64
    assert job_3["max_steps"] == 90
    assert len(job_1["frequency_modes"]) == 99
    assert len(job_2["frequency_modes"]) == 99
    assert len(job_3["frequency_modes"]) == 99
